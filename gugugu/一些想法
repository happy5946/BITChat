大概的一些思路

2019年4月16日
8:07

我也不知道到底算不算画蛇添足，但是确实也不知道要怎么搞了，就先随便写写。主要是自己看的，有兴趣可以先看看（可能也看不懂写的太乱了），有问题也可以商量一下。

先按TIM来写，具体以后看看再说。

main函数：
	入口，创建socket线程（？暂时否决），创建套接字暂时不连接（？为了登陆界面的设置IP，是否需要是否连接暂定）。创建登录界面线程，阻塞。接收到登陆成功消息后停止登录线程，创建主界面线程，socket线程阻塞，主界面线程阻塞。主界面进程结束同时销毁socket线程。
一些问题：
	创建登陆线程时要注意保存账号密码到本地（？），防止后期socket意外终止时重建线程重新连接服务器（？）。
	一个socket线程是否可以满足需求，或者用socket创建子socket（否决）。
	socket线程意外终止或者界面意外终止的处理办法。
	是否需要多个线程进行数据收发？（暂定不需要减轻负担）
收发信息：
	发送时发送内容主要为目标ip，命令（是发送信息还是文件还是登录申请还是注册申请等），内容（文件或信息或账号密码），时间，等。接受也差不多。
	文件可能需要多次通信，先确定是不是要接受文件，确定后返回到服务器，然后服务器再发文件给账户。

登陆界面：
	登录按钮和注册按钮和设置按钮（设置服务器主机IP）。  
	直接创建图形线程，收集用户账号密码保存到本地（?)，与socket通信发送账号密码（？暂时否定），登录时调用main的套接字发送（格式如上，注意发送和接收超时），同时创建新线程准备接受服务器返回信息以及对信息进行处理。（应该不能发送后再接受吧？可以试试看），若返回信息为成功则输出登录成功，一段时间后结束图形线程并向主线程返回登录信息及账号，失败则显示连接失败并准备返回登录界面。注册先不说。
	
	问题：结束图形后socket连接是否会断开？（先用指针试试）。  
主界面：(暂不考虑群聊先)    
	main函数接受登录信息后创建主界面线程，向服务器请求导入数据。接受来自服务器的账号信息（用文件吧…）并载入信息显示图形。
	收发信息先不用太多线程（也就是非并行），先创建一个接受线程负责数据接受（注意防止同时接受产生错误，要使用互斥量啥的），获得数据后使用另一个函数处理信息判断是文件还是信息以及数据到底传给谁，然后分发给主界面（奥，还要存在本地然后打开窗口的时候读取出来），主界面则进行信息动态显示，比如好友ip后方显示信息个数，或者窗口界面显示信息个数等。聊天窗口界面有发送接受界面还有文件界面，发送按钮按下则使用send方法，不需要创建新线程（应该），发送内容…用结构吧。接受内容则显示ip，用户名，时间和收到的信息。点击历史记录时从 本地读取历史记录文件，点击刷新则向数据库请求同步接受新的历史记录文件。接受文件先把文件存在本地，不同意删除，同意则移动文件到指定位置。（也可以多次通讯然后再接收文件，分两次）
	  
	综上，客户端数据IO主要是文件的发送，移动，数据同步，删除等。具体文件有历史记录，临时文件（收到的文件等），个人信息文件，好友等。应该是每个人一个文件夹。
	好友添加删除：也是大概向服务器多次通讯然后删除后动态重载好友界面。  
	个人信息设置，设置完之后传文件给服务器进行同步。  
	  
	这个项目比较大，先搞搞看看。  
	  
需要看的还有一些线程同步，通信，结束其他进程，重启线程等。  
